<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QRA Protocol Generator - Clinical Documentation System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .controls-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .qra-points-grid {
            margin: 20px 0;
        }
        
        .point-category {
            margin-bottom: 25px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #f9f9f9;
        }
        
        .point-category h4 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 16px;
            font-weight: bold;
        }
        
        .point-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }
        
        .point-row label {
            display: flex;
            align-items: center;
            padding: 8px;
            background: white;
            border: 1px solid #eee;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .point-row label:hover {
            background: #f0f8ff;
        }
        
        .point-row input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.2);
        }
        
        .bilateral-points, .multiple-points {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .bilateral-group, .multiple-group {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
            background: white;
            border: 1px solid #eee;
            border-radius: 6px;
            flex-wrap: wrap;
        }
        
        .point-name {
            font-weight: bold;
            color: #2c3e50;
            min-width: 200px;
        }
        
        .bilateral-group label, .multiple-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            margin: 0;
            padding: 5px 10px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .bilateral-group label:hover, .multiple-group label:hover {
            background: #e9ecef;
            border-color: #007bff;
        }
        
        .bilateral-group input[type="checkbox"], .multiple-group input[type="checkbox"] {
            margin: 0;
            transform: scale(1.1);
        }
        
        .quick-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .quick-controls button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .quick-controls button:first-child {
            background: #6c757d;
            color: white;
        }
        
        .quick-controls button:first-child:hover {
            background: #5a6268;
        }
        
        .quick-controls button:last-child {
            background: #007bff;
            color: white;
        }
        
        .quick-controls button:last-child:hover {
            background: #0056b3;
        }
        
        .weak-points-summary {
            background: #e8f4f8;
            border: 1px solid #b8daff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .pattern-analysis {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .priority-analysis {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .knowledge-gaps {
            background: #e2e3e5;
            border: 1px solid #d6d8db;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .gap-item {
            color: #6c757d;
            font-style: italic;
        }
        
        #recommendations-results {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .recommendation-item, .custom-recommendation-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            border-left: 4px solid #007bff;
        }
        
        .custom-recommendation-item {
            border-left-color: #28a745;
        }
        
        .success-note {
            display: block;
            color: #28a745;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .form-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 500;
            margin-bottom: 5px;
            color: #333;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .photo-upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: #fafafa;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .photo-upload-area:hover {
            border-color: #007bff;
            background: #f0f8ff;
        }
        
        .photo-upload-area input {
            display: none;
        }
        
        .photo-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .photo-preview img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        
        .saved-protocols {
            margin-top: 30px;
        }
        
        .protocol-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .protocol-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .protocol-date {
            font-weight: bold;
            color: #007bff;
        }
        
        .protocol-actions {
            display: flex;
            gap: 10px;
        }
        
        .protocol-actions button {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .view-btn {
            background: #007bff;
            color: white;
        }
        
        .delete-btn {
            background: #dc3545;
            color: white;
        }
        
        .export-btn {
            background: #28a745;
            color: white;
            margin-top: 20px;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .point-row {
                grid-template-columns: 1fr;
            }
            
            .bilateral-group, .multiple-group {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .point-name {
                min-width: auto;
                margin-bottom: 8px;
            }
            
            .bilateral-group label, .multiple-group label {
                margin: 2px 0;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .quick-controls {
                flex-direction: column;
            }
            
            .protocol-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
            }
            
            .quick-controls, .protocol-actions, .export-btn {
                display: none;
            }
            
            .form-section {
                page-break-inside: avoid;
            }
            
            .photo-preview img {
                max-width: 150px;
                max-height: 120px;
                margin: 5px;
                page-break-inside: avoid;
            }
            
            .photo-upload-area {
                display: none;
            }
            
            /* Ensure photos print in color */
            .photo-preview {
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }
            
            /* Group photos nicely on print */
            #photo-preview, #emitter-photo-preview, #dial-photo-preview {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                margin: 10px 0;
                page-break-inside: avoid;
            }
            
            /* Add labels for photo sections when printing */
            #emitter-photo-preview:before {
                content: "Emitter Photos:";
                font-weight: bold;
                width: 100%;
                display: block;
                margin-bottom: 5px;
            }
            
            #dial-photo-preview:before {
                content: "Dial Readings Photos:";
                font-weight: bold;
                width: 100%;
                display: block;
                margin-bottom: 5px;
            }
            
            #photo-preview:before {
                content: "Completed Work Photos:";
                font-weight: bold;
                width: 100%;
                display: block;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß¨ QRA Protocol Generator</h1>
            <p>Clinical Documentation System for Quantum Reflex Analysis</p>
        </div>
        
        <div class="main-content">
            <!-- Manual Point Selection -->
            <div class="controls-section">
                <h3>Select Weak Measurement Points</h3>
                <p>Check all points that tested weak in your QRA assessment:</p>
                
                <!-- Quick Selection Controls -->
                <div class="quick-controls">
                    <button onclick="clearAllWeakPoints()">Clear All</button>
                    <button onclick="generateRecommendations()">Generate Recommendations</button>
                </div>
                
                <!-- QRA Points Selection Grid -->
                <div class="qra-points-grid">
                    <!-- Single Points -->
                    <div class="point-category">
                        <h4>Single Points</h4>
                        <div class="point-row">
                            <label><input type="checkbox" class="weak-point" value="1" data-name="Sacral CC (CC-3)"> 1. Sacral CC (CC-3)</label>
                            <label><input type="checkbox" class="weak-point" value="3" data-name="Brain 1 MP (GV-20)"> 3. Brain 1 MP (GV-20)</label>
                            <label><input type="checkbox" class="weak-point" value="4" data-name="Hypothalamus MP"> 4. Hypothalamus MP</label>
                            <label><input type="checkbox" class="weak-point" value="5" data-name="Pituitary MP"> 5. Pituitary MP</label>
                            <label><input type="checkbox" class="weak-point" value="9" data-name="Thyroid MP (CV-22)"> 9. Thyroid MP (CV-22)</label>
                            <label><input type="checkbox" class="weak-point" value="10" data-name="Thymus MP"> 10. Thymus MP</label>
                            <label><input type="checkbox" class="weak-point" value="11" data-name="Heart Inflow MP (L only)"> 11. Heart Inflow MP (L only)</label>
                            <label><input type="checkbox" class="weak-point" value="12" data-name="Heart Outflow MP (CV-14)"> 12. Heart Outflow MP (CV-14)</label>
                            <label><input type="checkbox" class="weak-point" value="13" data-name="Stomach MP (CV-12)"> 13. Stomach MP (CV-12)</label>
                            <label><input type="checkbox" class="weak-point" value="14" data-name="Small Intestine MP (CV-4)"> 14. Small Intestine MP (CV-4)</label>
                            <label><input type="checkbox" class="weak-point" value="15" data-name="Colon MP (S-49)"> 15. Colon MP (S-49)</label>
                            <label><input type="checkbox" class="weak-point" value="16" data-name="Uterus MP (CV-3)"> 16. Uterus MP (CV-3)</label>
                            <label><input type="checkbox" class="weak-point" value="16" data-name="Prostate MP (CV-3)"> 16. Prostate MP (CV-3)</label>
                            <label><input type="checkbox" class="weak-point" value="22" data-name="Spleen MP (LIV-13) L only"> 22. Spleen MP (LIV-13) L only</label>
                            <label><input type="checkbox" class="weak-point" value="23" data-name="Insulin MP (ST-19) L only"> 23. Insulin MP (ST-19) L only</label>
                            <label><input type="checkbox" class="weak-point" value="24" data-name="Gallbladder MP (GB-24) R only"> 24. Gallbladder MP (GB-24) R only</label>
                            <label><input type="checkbox" class="weak-point" value="25" data-name="Liver MP (LIV-14) R only"> 25. Liver MP (LIV-14) R only</label>
                            <label><input type="checkbox" class="weak-point" value="26" data-name="Pancreas MP (LIV-13) R only"> 26. Pancreas MP (LIV-13) R only</label>
                            <label><input type="checkbox" class="weak-point" value="28" data-name="Bone MP (GV-14)"> 28. Bone MP (GV-14)</label>
                            <label><input type="checkbox" class="weak-point" value="30" data-name="Frontal Sinus"> 30. Frontal Sinus</label>
                        </div>
                    </div>

                    <!-- Bilateral Points -->
                    <div class="point-category">
                        <h4>Bilateral Points (L & R)</h4>
                        <div class="bilateral-points">
                            <div class="bilateral-group">
                                <span class="point-name">2. Kidney MPs (UB-23):</span>
                                <label><input type="checkbox" class="weak-point" value="2L" data-name="Kidney MP Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="2R" data-name="Kidney MP Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">6. Occipital Lobe MPs (S1):</span>
                                <label><input type="checkbox" class="weak-point" value="6L" data-name="Occipital Lobe MP Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="6R" data-name="Occipital Lobe MP Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">7. Cell Energy MPs (TW-20):</span>
                                <label><input type="checkbox" class="weak-point" value="7L" data-name="Cell Energy MP Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="7R" data-name="Cell Energy MP Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">8. Parathyroid MPs (S2):</span>
                                <label><input type="checkbox" class="weak-point" value="8L" data-name="Parathyroid MP Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="8R" data-name="Parathyroid MP Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">17. Ovary/Testes MPs (ST-29):</span>
                                <label><input type="checkbox" class="weak-point" value="17L" data-name="Ovary/Testes MP Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="17R" data-name="Ovary/Testes MP Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">18. Urinary Bladder MPs:</span>
                                <label><input type="checkbox" class="weak-point" value="18L" data-name="Urinary Bladder MP Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="18R" data-name="Urinary Bladder MP Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">19. Circulation MPs (SP-10):</span>
                                <label><input type="checkbox" class="weak-point" value="19L" data-name="Circulation MP Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="19R" data-name="Circulation MP Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">20. Lymphatic MPs (S6):</span>
                                <label><input type="checkbox" class="weak-point" value="20L" data-name="Lymphatic MP Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="20R" data-name="Lymphatic MP Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">21. Adrenal MPs (GB-25):</span>
                                <label><input type="checkbox" class="weak-point" value="21L" data-name="Adrenal MP Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="21R" data-name="Adrenal MP Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">27. Deep Sleep MPs (S5):</span>
                                <label><input type="checkbox" class="weak-point" value="27L" data-name="Deep Sleep MP Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="27R" data-name="Deep Sleep MP Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">29. Lung MPs (LU-1):</span>
                                <label><input type="checkbox" class="weak-point" value="29L" data-name="Lung MP Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="29R" data-name="Lung MP Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">30. Maxillary Sinus MPs:</span>
                                <label><input type="checkbox" class="weak-point" value="30L" data-name="Maxillary Sinus Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="30R" data-name="Maxillary Sinus Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">30. Ethmoid Sinus MPs:</span>
                                <label><input type="checkbox" class="weak-point" value="30EL" data-name="Ethmoid Sinus Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="30ER" data-name="Ethmoid Sinus Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">31. Brain 2 MPs (S3):</span>
                                <label><input type="checkbox" class="weak-point" value="31L" data-name="Brain 2 MP Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="31R" data-name="Brain 2 MP Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">32. Brain 3 MPs (S4):</span>
                                <label><input type="checkbox" class="weak-point" value="32L" data-name="Brain 3 MP Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="32R" data-name="Brain 3 MP Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">33. Parotid Gland MPs (S7):</span>
                                <label><input type="checkbox" class="weak-point" value="33L" data-name="Parotid Gland MP Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="33R" data-name="Parotid Gland MP Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">35. Eye MPs (S10):</span>
                                <label><input type="checkbox" class="weak-point" value="35L" data-name="Eye MP Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="35R" data-name="Eye MP Right"> Right</label>
                            </div>
                            <div class="bilateral-group">
                                <span class="point-name">37. Ear MPs (S12):</span>
                                <label><input type="checkbox" class="weak-point" value="37L" data-name="Ear MP Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="37R" data-name="Ear MP Right"> Right</label>
                            </div>
                        </div>
                    </div>

                    <!-- Multiple Area Points -->
                    <div class="point-category">
                        <h4>Multiple Area Points</h4>
                        <div class="multiple-points">
                            <div class="multiple-group">
                                <span class="point-name">34. Sweat Band MPs (S9):</span>
                                <label><input type="checkbox" class="weak-point" value="34L" data-name="Sweat Band Left"> Left</label>
                                <label><input type="checkbox" class="weak-point" value="34C" data-name="Sweat Band Center"> Center</label>
                                <label><input type="checkbox" class="weak-point" value="34R" data-name="Sweat Band Right"> Right</label>
                            </div>
                            <div class="multiple-group">
                                <span class="point-name">36. Skin MPs (S11):</span>
                                <label><input type="checkbox" class="weak-point" value="36A" data-name="Skin Area 1"> Area 1</label>
                                <label><input type="checkbox" class="weak-point" value="36B" data-name="Skin Area 2"> Area 2</label>
                                <label><input type="checkbox" class="weak-point" value="36C" data-name="Skin Area 3"> Area 3</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommendations Results -->
            <div id="recommendations-results"></div>

            <!-- Protocol Documentation Form -->
            <div class="form-section" id="protocol-form" style="display: none;">
                <h3>üìã Document Custom Protocol</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="assessment-date">Assessment Date:</label>
                        <input type="date" id="assessment-date" required>
                    </div>
                    <div class="form-group">
                        <label for="client-initials">Client Initials:</label>
                        <input type="text" id="client-initials" placeholder="e.g., J.S." maxlength="10">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="weak-points-found">Weak Points Found:</label>
                        <textarea id="weak-points-found" readonly placeholder="Auto-populated from selection above"></textarea>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="emitter-measurements">Emitter/Archetype Ruler Measurements:</label>
                        <textarea id="emitter-measurements" placeholder="Document angles, positions, calibration settings for emitters created"></textarea>
                        <div class="photo-upload-area" onclick="document.getElementById('emitter-photo-upload').click()" style="margin-top: 10px;">
                            <input type="file" id="emitter-photo-upload" multiple accept="image/*" onchange="handleEmitterPhotoUpload(event)">
                            <p>üì∏ Add photos of emitter setup and measurements</p>
                        </div>
                        <div id="emitter-photo-preview" class="photo-preview"></div>
                    </div>
                    <div class="form-group">
                        <label for="biosignature-details">Biosignature Chosen:</label>
                        <textarea id="biosignature-details" placeholder="Geometric patterns selected, measurements, radiesthetic findings"></textarea>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="dial-angles">Radiesthetic Dial Angles:</label>
                        <textarea id="dial-angles" placeholder="Specific dial measurements, frequencies, band readings"></textarea>
                        <div class="photo-upload-area" onclick="document.getElementById('dial-photo-upload').click()" style="margin-top: 10px;">
                            <input type="file" id="dial-photo-upload" multiple accept="image/*" onchange="handleDialPhotoUpload(event)">
                            <p>üì∏ Add photos of dial readings and measurements</p>
                        </div>
                        <div id="dial-photo-preview" class="photo-preview"></div>
                    </div>
                    <div class="form-group">
                        <label for="biogeometry-tools">BioGeometry Tools Used:</label>
                        <textarea id="biogeometry-tools" placeholder="Rings, strips, harmonizers, placement details"></textarea>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="custom-solutions">Custom Solutions Applied:</label>
                        <textarea id="custom-solutions" placeholder="Your unique approaches, combinations, timing protocols"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="success-indicators">Success Indicators:</label>
                        <select id="success-indicators">
                            <option value="">Select outcome...</option>
                            <option value="immediate-improvement">Immediate Improvement (same session)</option>
                            <option value="improved-next-session">Improved at Next Session</option>
                            <option value="partial-improvement">Partial Improvement</option>
                            <option value="no-change">No Change</option>
                            <option value="follow-up-needed">Follow-up Needed</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="clinical-notes">Clinical Notes & Context:</label>
                    <textarea id="clinical-notes" placeholder="Environmental factors, client history, patterns observed, future recommendations"></textarea>
                </div>
                
                <!-- Photo Upload Section -->
                <div class="form-group">
                    <label>üì∏ Photos of Completed Work:</label>
                    <div class="photo-upload-area" onclick="document.getElementById('photo-upload').click()">
                        <input type="file" id="photo-upload" multiple accept="image/*" onchange="handlePhotoUpload(event)">
                        <p>üì± Tap to add photos of emitters, biosignatures, tool setups</p>
                        <small>Multiple photos supported - document your process!</small>
                    </div>
                    <div id="photo-preview" class="photo-preview"></div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="follow-up-date">Next Follow-up Date:</label>
                        <input type="date" id="follow-up-date">
                    </div>
                    <div class="form-group">
                        <label for="protocol-priority">Protocol Priority:</label>
                        <select id="protocol-priority">
                            <option value="routine">Routine</option>
                            <option value="important">Important</option>
                            <option value="critical">Critical</option>
                            <option value="research">Research Interest</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                    <button onclick="saveProtocol()" style="background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: 500;">üíæ Save Protocol</button>
                    <button onclick="printProtocol()" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: 500;">üñ®Ô∏è Print Report</button>
                    <button onclick="clearForm()" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: 500;">üóëÔ∏è Clear Form</button>
                </div>
            </div>

            <!-- Saved Protocols Section -->
            <div class="saved-protocols">
                <h3>üìö Saved Clinical Protocols</h3>
                <div id="saved-protocols-list"></div>
                <button onclick="exportData()" class="export-btn">üì§ Export All Data</button>
            </div>
        </div>
    </div>

    <script>
        // Clear all weak point selections
        function clearAllWeakPoints() {
            document.querySelectorAll('.weak-point').forEach(cb => cb.checked = false);
        }

        // Generate recommendations based on selected weak points
        function generateRecommendations() {
            const selectedPoints = [];
            document.querySelectorAll('.weak-point:checked').forEach(cb => {
                selectedPoints.push({
                    value: cb.value,
                    name: cb.getAttribute('data-name')
                });
            });
            
            if (selectedPoints.length === 0) {
                alert('Please select at least one weak measurement point first.');
                return;
            }
            
            const recommendations = getStandardRecommendations(selectedPoints);
            const customRecommendations = getCustomRecommendations(selectedPoints);
            const patternAnalysis = analyzeSelectedPattern(selectedPoints);
            
            displayRecommendations(recommendations, customRecommendations, patternAnalysis, selectedPoints);
        }
        
        function analyzeSelectedPattern(selectedPoints) {
            const pointValues = selectedPoints.map(p => p.value);
            const patterns = [];
            const priorities = [];
            
            // Pattern recognition
            if (pointValues.some(p => ['2L', '2R', '2'].includes(p)) && 
                pointValues.some(p => ['21L', '21R', '21'].includes(p))) {
                patterns.push('üîó KIDNEY-ADRENAL EXHAUSTION: Classic stress and fatigue pattern');
                priorities.push('HIGH: Support adrenal-kidney axis first');
            }
            
            if (pointValues.some(p => ['2L', '2R', '2'].includes(p)) && 
                pointValues.some(p => ['25'].includes(p))) {
                patterns.push('üîó DETOXIFICATION OVERLOAD: Kidney-liver stress pattern');
                priorities.push('HIGH: Support detox pathways');
            }
            
            if (pointValues.some(p => p.startsWith('36'))) {
                patterns.push('üîó INTERFERENCE FIELD: Scar/trauma blocking energy flow');
                priorities.push('IMMEDIATE: Clear interference fields first - blocks all other healing');
            }
            
            if (pointValues.some(p => ['13'].includes(p)) && 
                (pointValues.some(p => ['25'].includes(p)) || pointValues.some(p => ['26'].includes(p)))) {
                patterns.push('üîó DIGESTIVE DYSFUNCTION: Stomach-liver-pancreas imbalance');
                priorities.push('MEDIUM: Digestive system optimization');
            }
            
            if (pointValues.some(p => ['3', '31L', '31R', '32L', '32R'].includes(p))) {
                patterns.push('üîó NEUROLOGICAL STRESS: Brain function and sleep disruption');
                priorities.push('HIGH: Brain and nervous system support');
            }
            
            return { patterns, priorities };
        }

        function getStandardRecommendations(selectedPoints) {
            const pointValues = selectedPoints.map(p => p.value);
            const recommendations = [];
            
            // Standard QRA nutritional protocols from Premier Research Labs (from uploaded QRA manual)
            const standardProtocols = {
                '1': 'Sacral CC: Adaptogen-R3‚Ñ¢, Pr. Multi Vitamin, AdrenaVen‚Ñ¢, Pr. DHA, EPA/DHA Marine',
                '2': 'Kidney MP: Pr. DHA, EPA/DHA Marine, RenaVen‚Ñ¢, Inflammacidin, CircuZyme, NZ-Red Velvet Deer Antler, Pr. Multi Vitamin, AllerCaps, Aloe Powder Mixed Berries, Pr. Aloe, CardioVen, Fermented Greens Capsules, Pr. Joint & Disc, Cardio-ND‚Ñ¢, Hyssinol‚Ñ¢',
                '2L': 'Kidney Left: Pr. DHA, EPA/DHA Marine, RenaVen‚Ñ¢, Inflammacidin, CircuZyme, NZ-Red Velvet Deer Antler, Pr. Multi Vitamin',
                '2R': 'Kidney Right: Pr. DHA, EPA/DHA Marine, RenaVen‚Ñ¢, Inflammacidin, CircuZyme, NZ-Red Velvet Deer Antler, Pr. Multi Vitamin',
                '3': 'Brain 1 MP: Pr. DHA, Pr. Complete B Capsules, CogniTropic‚Ñ¢, Max B-ND‚Ñ¢, NZ-Red Velvet Deer Antler, Pr. Multi Vitamin, Pr. Aloe, EPA/DHA Marine, Tranquinol',
                '4': 'Hypothalamus: Adaptogen-R3‚Ñ¢, Pr. Green Tea Extract, CogniTropic‚Ñ¢, NZ-Red Velvet Deer Antler, Amino hGH, Pr. Magnesium Powder, D3 Serum',
                '5': 'Pituitary: Adaptogen-R3‚Ñ¢, Radiant Woman, Testosterone Premium, Pr. B6 Ultra, Pr. Multi Vitamin, XenoStat (1 capsule), Hyssinol‚Ñ¢',
                '6L': 'Occipital Lobe Left: Pr. Green Tea Extract, Pr. Complete B Capsules, Max B-ND‚Ñ¢, Astaxanthin Complex, PQQ Complex, Pr. CoQ-10, Green Tea-ND‚Ñ¢, Pr. Plant Vitamin C, Pr. Taurine Blend, Pr. Glutathione Complex, Pr. Fermented Turmeric/Ginger, Pr. Resveratrol',
                '6R': 'Occipital Lobe Right: Pr. Green Tea Extract, Pr. Complete B Capsules, Max B-ND‚Ñ¢, Astaxanthin Complex, PQQ Complex, Pr. CoQ-10, Green Tea-ND‚Ñ¢, Pr. Plant Vitamin C, Pr. Taurine Blend, Pr. Glutathione Complex, Pr. Fermented Turmeric/Ginger, Pr. Resveratrol',
                '7L': 'Cell Energy Left: Medi-Clay-FX‚Ñ¢, Pr. Multi Vitamin, PQQ Complex, Pr. Complete B Capsules, Max B-ND‚Ñ¢, Pr. CoQ-10, CardioVen‚Ñ¢, Pr. NADH, Pr. Glutathione Complex, Pr. ACV, B12-ND‚Ñ¢, Astaxanthin Complex',
                '7R': 'Cell Energy Right: Medi-Clay-FX‚Ñ¢, Pr. Multi Vitamin, PQQ Complex, Pr. Complete B Capsules, Max B-ND‚Ñ¢, Pr. CoQ-10, CardioVen‚Ñ¢, Pr. NADH, Pr. Glutathione Complex, Pr. ACV, B12-ND‚Ñ¢, Astaxanthin Complex',
                '8L': 'Parathyroid Left: Pr. Green Tea Extract, Medi-Chlorella-FX, Pr. Vitamin D3+K2, Green Tea-ND‚Ñ¢, Pr. NAC, HM-ND‚Ñ¢, Allicidin',
                '8R': 'Parathyroid Right: Pr. Green Tea Extract, Medi-Chlorella-FX, Pr. Vitamin D3+K2, Green Tea-ND‚Ñ¢, Pr. NAC, HM-ND‚Ñ¢, Allicidin',
                '9': 'Thyroid: XenoStat‚Ñ¢, Pr. Multi Vitamin, Pr. Green Tea Extract, ThyroVen‚Ñ¢, Tyrosine Matrix, Green Tea-ND‚Ñ¢, Pr. Noni, Pr. PhytoIron, ErythroPro¬Æ, Hyssinol‚Ñ¢',
                '10': 'Thymus: Allicidin¬Æ, Pr. Vitamin D3+K2, D3 Serum, Fermented Mushroom Blend, AllerCaps, Nucleo Immune‚Ñ¢, Canadian Gold Honey, Pr. Oregano Oil, Pr. Niacin, GrassFed Colostrum-IgG, Pr. Plant Protein, Pr. Whey Protein, Pr. Nutritional Flakes, ImmunoVen‚Ñ¢, Olive Leaf Immune',
                '11': 'Heart Inflow: CardioVen‚Ñ¢, Pr. Fermented Beets, Deltanol‚Ñ¢, CircuZyme‚Ñ¢, Pr. Taurine Blend, Pr. Magnesium Powder, Pr. Pink Salt, Pr. pH Minerals, Pr. B.P. Complex, ImmunoVen‚Ñ¢, Cardio-ND‚Ñ¢, Allicidin¬Æ',
                '12': 'Heart Outflow: CardioVen‚Ñ¢, Pr. Fermented Beets, Deltanol‚Ñ¢, CircuZyme‚Ñ¢, Pr. Taurine Blend, Pr. Magnesium Powder, Pr. Pink Salt, Pr. pH Minerals, Pr. B.P. Complex, ImmunoVen‚Ñ¢, Cardio-ND‚Ñ¢, Allicidin¬Æ',
                '13': 'Stomach: Pr. Pink Salt (up to age 30) / Pr. HCL (over age 30), GastroVen, Inflammacidin, Pr. Fermented Turmeric/Ginger, Aloe Powder Mixed Berries, Pr. Green Tea Extract, Pr. DHA, Pr. ACV, Green Tea-ND‚Ñ¢, Liquid Zinc Ultra, Pr. Limonene, EPA/DHA Marine',
                '14': 'Small Intestine: Pr. Digest, Inflammacidin, Medi-Clay-FX‚Ñ¢, Pr. ACV, Max B-ND‚Ñ¢, MicroBiome-18‚Ñ¢, Pr. Probiotic Caps, Pr. Marine Collagen, Pr. Psyllium Fiber, Pr. Nutritional Flakes, Pr. Glutamine, Pr. Fermented Greens Capsules, Digestase-SP‚Ñ¢, Allicidin¬Æ, ParaStat‚Ñ¢',
                '15': 'Colon: Medi-Clay-FX‚Ñ¢, Pr. Probiotic Caps, MicroBiome-18‚Ñ¢, Pr. Psyllium Fiber, Pr. Cleanse, CircuZyme, Allicidin¬Æ, ParaStat‚Ñ¢',
                '16': 'Reproductive: Adaptogen-R3‚Ñ¢, Radiant Woman / Testosterone Premium, Pr. Multi Vitamin, XenoStat‚Ñ¢',
                '17L': 'Ovary/Testes Left: Adaptogen-R3‚Ñ¢, Radiant Woman / Testosterone Premium, Pr. Multi Vitamin, XenoStat‚Ñ¢',
                '17R': 'Ovary/Testes Right: Adaptogen-R3‚Ñ¢, Radiant Woman / Testosterone Premium, Pr. Multi Vitamin, XenoStat‚Ñ¢',
                '18L': 'Urinary Bladder Left: Pr. DHA, RenaVen‚Ñ¢, Pr. Multi Vitamin, CircuZyme',
                '18R': 'Urinary Bladder Right: Pr. DHA, RenaVen‚Ñ¢, Pr. Multi Vitamin, CircuZyme',
                '19L': 'Circulation Left: CircuZyme, CardioVen‚Ñ¢, Pr. Fermented Beets, Deltanol‚Ñ¢, Pr. Taurine Blend',
                '19R': 'Circulation Right: CircuZyme, CardioVen‚Ñ¢, Pr. Fermented Beets, Deltanol‚Ñ¢, Pr. Taurine Blend',
                '20L': 'Lymphatic Left: Allicidin¬Æ, Pr. Vitamin D3+K2, Fermented Mushroom Blend, Nucleo Immune‚Ñ¢',
                '20R': 'Lymphatic Right: Allicidin¬Æ, Pr. Vitamin D3+K2, Fermented Mushroom Blend, Nucleo Immune‚Ñ¢',
                '21L': 'Adrenal Left: Adaptogen-R3‚Ñ¢, AdrenaVen‚Ñ¢, Pr. Multi Vitamin, NZ-Red Velvet Deer Antler',
                '21R': 'Adrenal Right: Adaptogen-R3‚Ñ¢, AdrenaVen‚Ñ¢, Pr. Multi Vitamin, NZ-Red Velvet Deer Antler',
                '22': 'Spleen: Pr. Multi Vitamin, Fermented Mushroom Blend, Allicidin¬Æ, Nucleo Immune‚Ñ¢',
                '23': 'Insulin: Pr. Diabetes, Pr. Multi Vitamin, Adaptogen-R3‚Ñ¢, Pr. Green Tea Extract',
                '24': 'Gallbladder: GallBladder-ND‚Ñ¢, Pr. Multi Vitamin, Pr. Digest, Liver-ND‚Ñ¢',
                '25': 'Liver: Liver-ND‚Ñ¢, Pr. Multi Vitamin, Medi-Clay-FX‚Ñ¢, Pr. NAC, HM-ND‚Ñ¢',
                '26': 'Pancreas: Pr. Digest, Digestase-SP‚Ñ¢, Pr. Multi Vitamin, PQQ Complex',
                '27L': 'Deep Sleep Left: Tranquinol, Pr. GABA, Pr. Magnesium Powder, Max B-ND‚Ñ¢',
                '27R': 'Deep Sleep Right: Tranquinol, Pr. GABA, Pr. Magnesium Powder, Max B-ND‚Ñ¢',
                '28': 'Bone: Pr. Vitamin D3+K2, Pr. Magnesium Powder, Pr. Pink Salt, Coral Legend',
                '29L': 'Lung Left: Allicidin¬Æ, Pr. Oregano Oil, AllerCaps, Pr. Multi Vitamin',
                '29R': 'Lung Right: Allicidin¬Æ, Pr. Oregano Oil, AllerCaps, Pr. Multi Vitamin',
                '30': 'Frontal Sinus: AllerCaps, Allicidin¬Æ, Pr. Oregano Oil, Pr. Multi Vitamin',
                '30L': 'Maxillary Sinus Left: AllerCaps, Allicidin¬Æ, Pr. Oregano Oil',
                '30R': 'Maxillary Sinus Right: AllerCaps, Allicidin¬Æ, Pr. Oregano Oil',
                '30EL': 'Ethmoid Sinus Left: AllerCaps, Allicidin¬Æ, Pr. Oregano Oil',
                '30ER': 'Ethmoid Sinus Right: AllerCaps, Allicidin¬Æ, Pr. Oregano Oil',
                '31L': 'Brain 2 Left: Pr. DHA, CogniTropic‚Ñ¢, Max B-ND‚Ñ¢, Pr. Complete B Capsules',
                '31R': 'Brain 2 Right: Pr. DHA, CogniTropic‚Ñ¢, Max B-ND‚Ñ¢, Pr. Complete B Capsules',
                '32L': 'Brain 3 Left: Pr. DHA, CogniTropic‚Ñ¢, Max B-ND‚Ñ¢, Pr. Complete B Capsules',
                '32R': 'Brain 3 Right: Pr. DHA, CogniTropic‚Ñ¢, Max B-ND‚Ñ¢, Pr. Complete B Capsules',
                '33L': 'Parotid Gland Left: Pr. Digest, Digestase-SP‚Ñ¢, Pr. ACV',
                '33R': 'Parotid Gland Right: Pr. Digest, Digestase-SP‚Ñ¢, Pr. ACV',
                '34L': 'Sweat Band Left: Medi-Clay-FX‚Ñ¢, HM-ND‚Ñ¢, Pr. NAC',
                '34C': 'Sweat Band Center: Medi-Clay-FX‚Ñ¢, HM-ND‚Ñ¢, Pr. NAC',
                '34R': 'Sweat Band Right: Medi-Clay-FX‚Ñ¢, HM-ND‚Ñ¢, Pr. NAC',
                '35L': 'Eye Left: Astaxanthin Complex, Pr. Plant Vitamin C, PQQ Complex',
                '35R': 'Eye Right: Astaxanthin Complex, Pr. Plant Vitamin C, PQQ Complex',
                '36A': 'Skin Area 1: Medi-Clay-FX‚Ñ¢, HM-ND‚Ñ¢, Pr. NAC (Interference field - requires geometric correction)',
                '36B': 'Skin Area 2: Medi-Clay-FX‚Ñ¢, HM-ND‚Ñ¢, Pr. NAC (Interference field - requires geometric correction)',
                '36C': 'Skin Area 3: Medi-Clay-FX‚Ñ¢, HM-ND‚Ñ¢, Pr. NAC (Interference field - requires geometric correction)',
                '37L': 'Ear Left: Pr. DHA, Max B-ND‚Ñ¢, Pr. Multi Vitamin',
                '37R': 'Ear Right: Pr. DHA, Max B-ND‚Ñ¢, Pr. Multi Vitamin'
            };
            
            // Generate recommendations for each selected point
            pointValues.forEach(pointValue => {
                const point = selectedPoints.find(p => p.value === pointValue);
                if (standardProtocols[pointValue]) {
                    recommendations.push({
                        point: point.name,
                        recommendation: standardProtocols[pointValue]
                    });
                }
            });
            
            return recommendations;
        }

        function getCustomRecommendations(selectedPoints) {
            const savedProtocols = JSON.parse(localStorage.getItem('qraProtocols') || '[]');
            const customRecs = [];
            const pointNames = selectedPoints.map(p => p.name);
            
            savedProtocols.forEach(protocol => {
                if (protocol.weakPoints) {
                    // Check if any of the current weak points match saved protocols
                    const matchingPoints = pointNames.filter(point => 
                        protocol.weakPoints.includes(point)
                    );
                    
                    if (matchingPoints.length > 0) {
                        customRecs.push({
                            context: `Previous case with ${matchingPoints.join(', ')}`,
                            solution: protocol.customSolutions || 'No custom solution documented'
                        });
                    }
                }
            });
            
            return customRecs;
        }

        function displayRecommendations(recommendations, customRecommendations, patternAnalysis, selectedPoints) {
            const resultsDiv = document.getElementById('recommendations-results');
            let html = '<h3>üéØ QRA Protocol Recommendations</h3>';
            
            // Display selected weak points
            html += '<div class="weak-points-summary">';
            html += '<h4>üìä Assessment Summary</h4>';
            html += '<p><strong>Weak Points Identified:</strong></p><ul>';
            selectedPoints.forEach(point => {
                html += `<li>${point.name}</li>`;
            });
            html += '</ul></div>';
            
            // Display pattern analysis
            if (patternAnalysis.patterns.length > 0) {
                html += '<div class="pattern-analysis">';
                html += '<h4>üîç Pattern Recognition</h4>';
                patternAnalysis.patterns.forEach(pattern => {
                    html += `<p>${pattern}</p>`;
                });
                html += '</div>';
            }
            
            // Display priorities
            if (patternAnalysis.priorities.length > 0) {
                html += '<div class="priority-analysis">';
                html += '<h4>üéØ Treatment Priorities</h4>';
                patternAnalysis.priorities.forEach(priority => {
                    html += `<p><strong>${priority}</strong></p>`;
                });
                html += '</div>';
            }
            
            // Standard recommendations
            if (recommendations.length > 0) {
                html += '<div class="standard-recommendations">';
                html += '<h4>üìã Standard Protocol Recommendations</h4>';
                recommendations.forEach(rec => {
                    html += `<div class="recommendation-item">
                        <strong>${rec.point}:</strong> ${rec.recommendation}
                    </div>`;
                });
                html += '</div>';
            }
            
            // Custom recommendations from saved protocols
            if (customRecommendations.length > 0) {
                html += '<div class="custom-recommendations">';
                html += '<h4>üß† Your Previous Solutions</h4>';
                customRecommendations.forEach(rec => {
                    html += `<div class="custom-recommendation-item">
                        <strong>${rec.context}:</strong> ${rec.solution}
                        <small class="success-note">‚úÖ Documented Success</small>
                    </div>`;
                });
                html += '</div>';
            }
            
            // Knowledge gaps
            const savedProtocols = JSON.parse(localStorage.getItem('qraProtocols') || '[]');
            const gaps = identifyProtocolGaps(selectedPoints, savedProtocols);
            if (gaps.length > 0) {
                html += '<div class="knowledge-gaps">';
                html += '<h4>‚ùì Research Opportunities</h4>';
                html += '<p>Consider documenting protocols for these combinations:</p>';
                gaps.forEach(gap => {
                    html += `<p class="gap-item">‚Ä¢ ${gap}</p>`;
                });
                html += '</div>';
            }
            
            resultsDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
            
            // Show protocol form and pre-populate
            document.getElementById('protocol-form').style.display = 'block';
            document.getElementById('assessment-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('weak-points-found').value = selectedPoints.map(p => p.name).join(', ');
        }
        
        function identifyProtocolGaps(selectedPoints, savedProtocols) {
            const gaps = [];
            const pointNames = selectedPoints.map(p => p.name);
            
            // Check for specific point combinations not in saved protocols
            for (let i = 0; i < pointNames.length; i++) {
                for (let j = i + 1; j < pointNames.length; j++) {
                    const combo = [pointNames[i], pointNames[j]].sort().join(' + ');
                    const hasProtocol = savedProtocols.some(protocol => 
                        protocol.weakPoints && 
                        protocol.weakPoints.includes(pointNames[i]) && 
                        protocol.weakPoints.includes(pointNames[j])
                    );
                    
                    if (!hasProtocol) {
                        gaps.push(combo);
                    }
                }
            }
            
            return [...new Set(gaps)].slice(0, 5); // Limit to 5 most important gaps
        }

        // Photo upload handling for different sections
        function handlePhotoUpload(event) {
            const files = Array.from(event.target.files);
            const preview = document.getElementById('photo-preview');
            
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.setAttribute('data-filename', file.name);
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function handleEmitterPhotoUpload(event) {
            const files = Array.from(event.target.files);
            const preview = document.getElementById('emitter-photo-preview');
            
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.setAttribute('data-filename', file.name);
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function handleDialPhotoUpload(event) {
            const files = Array.from(event.target.files);
            const preview = document.getElementById('dial-photo-preview');
            
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.setAttribute('data-filename', file.name);
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // Save protocol to localStorage
        function saveProtocol() {
            const protocol = {
                id: Date.now(),
                date: document.getElementById('assessment-date').value,
                clientInitials: document.getElementById('client-initials').value,
                weakPoints: document.getElementById('weak-points-found').value,
                emitterMeasurements: document.getElementById('emitter-measurements').value,
                biosignatureDetails: document.getElementById('biosignature-details').value,
                dialAngles: document.getElementById('dial-angles').value,
                biogeometryTools: document.getElementById('biogeometry-tools').value,
                customSolutions: document.getElementById('custom-solutions').value,
                successIndicators: document.getElementById('success-indicators').value,
                clinicalNotes: document.getElementById('clinical-notes').value,
                followUpDate: document.getElementById('follow-up-date').value,
                protocolPriority: document.getElementById('protocol-priority').value,
                photos: Array.from(document.querySelectorAll('#photo-preview img')).map(img => ({
                    src: img.src,
                    filename: img.getAttribute('data-filename'),
                    type: 'completed-work'
                })),
                emitterPhotos: Array.from(document.querySelectorAll('#emitter-photo-preview img')).map(img => ({
                    src: img.src,
                    filename: img.getAttribute('data-filename'),
                    type: 'emitter'
                })),
                dialPhotos: Array.from(document.querySelectorAll('#dial-photo-preview img')).map(img => ({
                    src: img.src,
                    filename: img.getAttribute('data-filename'),
                    type: 'dial'
                }))
            };
            
            if (!protocol.date || !protocol.weakPoints) {
                alert('Please fill in at least the assessment date and weak points.');
                return;
            }
            
            const savedProtocols = JSON.parse(localStorage.getItem('qraProtocols') || '[]');
            savedProtocols.push(protocol);
            localStorage.setItem('qraProtocols', JSON.stringify(savedProtocols));
            
            alert('‚úÖ Protocol saved successfully!');
            displaySavedProtocols();
            clearForm();
        }

        // Print protocol
        function printProtocol() {
            window.print();
        }

        // Clear form
        function clearForm() {
            document.querySelectorAll('input, textarea, select').forEach(field => {
                if (field.type !== 'date' && field.id !== 'assessment-date') {
                    field.value = '';
                }
            });
            document.getElementById('photo-preview').innerHTML = '';
            document.getElementById('emitter-photo-preview').innerHTML = '';
            document.getElementById('dial-photo-preview').innerHTML = '';
            document.querySelectorAll('.weak-point').forEach(cb => cb.checked = false);
            document.getElementById('recommendations-results').style.display = 'none';
            document.getElementById('protocol-form').style.display = 'none';
        }

        // Display saved protocols
        function displaySavedProtocols() {
            const savedProtocols = JSON.parse(localStorage.getItem('qraProtocols') || '[]');
            const container = document.getElementById('saved-protocols-list');
            
            if (savedProtocols.length === 0) {
                container.innerHTML = '<p>No saved protocols yet. Complete an assessment to get started!</p>';
                return;
            }
            
            let html = '';
            savedProtocols.reverse().forEach(protocol => {
                html += `
                    <div class="protocol-item">
                        <div class="protocol-header">
                            <div>
                                <span class="protocol-date">${protocol.date}</span>
                                ${protocol.clientInitials ? `- ${protocol.clientInitials}` : ''}
                                <span class="protocol-priority-badge">[${protocol.protocolPriority || 'routine'}]</span>
                            </div>
                            <div class="protocol-actions">
                                <button class="view-btn" onclick="viewProtocol(${protocol.id})">View</button>
                                <button class="delete-btn" onclick="deleteProtocol(${protocol.id})">Delete</button>
                            </div>
                        </div>
                        <div class="protocol-summary">
                            <strong>Weak Points:</strong> ${protocol.weakPoints}<br>
                            ${protocol.customSolutions ? `<strong>Solutions:</strong> ${protocol.customSolutions.substring(0, 100)}...` : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // View specific protocol
        function viewProtocol(id) {
            const savedProtocols = JSON.parse(localStorage.getItem('qraProtocols') || '[]');
            const protocol = savedProtocols.find(p => p.id === id);
            
            if (!protocol) return;
            
            // Populate form with protocol data
            document.getElementById('assessment-date').value = protocol.date;
            document.getElementById('client-initials').value = protocol.clientInitials || '';
            document.getElementById('weak-points-found').value = protocol.weakPoints;
            document.getElementById('emitter-measurements').value = protocol.emitterMeasurements || '';
            document.getElementById('biosignature-details').value = protocol.biosignatureDetails || '';
            document.getElementById('dial-angles').value = protocol.dialAngles || '';
            document.getElementById('biogeometry-tools').value = protocol.biogeometryTools || '';
            document.getElementById('custom-solutions').value = protocol.customSolutions || '';
            document.getElementById('success-indicators').value = protocol.successIndicators || '';
            document.getElementById('clinical-notes').value = protocol.clinicalNotes || '';
            document.getElementById('follow-up-date').value = protocol.followUpDate || '';
            document.getElementById('protocol-priority').value = protocol.protocolPriority || 'routine';
            
            // Display completed work photos
            const photoPreview = document.getElementById('photo-preview');
            photoPreview.innerHTML = '';
            if (protocol.photos) {
                protocol.photos.forEach(photo => {
                    const img = document.createElement('img');
                    img.src = photo.src;
                    img.setAttribute('data-filename', photo.filename);
                    photoPreview.appendChild(img);
                });
            }
            
            // Display emitter photos
            const emitterPreview = document.getElementById('emitter-photo-preview');
            emitterPreview.innerHTML = '';
            if (protocol.emitterPhotos) {
                protocol.emitterPhotos.forEach(photo => {
                    const img = document.createElement('img');
                    img.src = photo.src;
                    img.setAttribute('data-filename', photo.filename);
                    emitterPreview.appendChild(img);
                });
            }
            
            // Display dial photos
            const dialPreview = document.getElementById('dial-photo-preview');
            dialPreview.innerHTML = '';
            if (protocol.dialPhotos) {
                protocol.dialPhotos.forEach(photo => {
                    const img = document.createElement('img');
                    img.src = photo.src;
                    img.setAttribute('data-filename', photo.filename);
                    dialPreview.appendChild(img);
                });
            }
            
            document.getElementById('protocol-form').style.display = 'block';
            document.getElementById('protocol-form').scrollIntoView();
        }

        // Delete protocol
        function deleteProtocol(id) {
            if (confirm('Are you sure you want to delete this protocol?')) {
                const savedProtocols = JSON.parse(localStorage.getItem('qraProtocols') || '[]');
                const filteredProtocols = savedProtocols.filter(p => p.id !== id);
                localStorage.setItem('qraProtocols', JSON.stringify(filteredProtocols));
                displaySavedProtocols();
            }
        }

        // Export all data
        function exportData() {
            const savedProtocols = JSON.parse(localStorage.getItem('qraProtocols') || '[]');
            const dataStr = JSON.stringify(savedProtocols, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `qra-protocols-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            displaySavedProtocols();
        });
    </script>
</body>
</html>